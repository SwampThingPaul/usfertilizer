<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data sources and processing procedures â€¢ County-lelel nutrients data from 1945 to 2012 in USA</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/journal/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Data sources and processing procedures">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">usfertilizer</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/Introduction.html">Getting Started</a>
</li>
<li>
  <a href="../articles/Data_sources_and_cleaning.html">Data sources</a>
</li>
<li>
  <a href="../reference/us_fertilizer_county.html">Dataset description</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="../news/index.html">News</a>
</li>
<li>
  <a href="https://github.com/wenlong-liu/usfertilizer">
    <span class="fa fa-github fa-lg"></span>
     
    Github
  </a>
</li>
<li>
  <a href="https://twitter.com/tianya0423">
    <span class="fa fa-twitter fa-lg"></span>
     
    Twitter
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Data sources and processing procedures</h1>
                        <h4 class="author">Wenlong</h4>
            
            <h4 class="date">2018-05-01</h4>
      
      <small>Source: <a href="https://github.com/wenlong-liu/usfertilizer/blob/master/vignettes/Data_sources_and_cleaning.Rmd"><code>vignettes/Data_sources_and_cleaning.Rmd</code></a></small>

    </div>

    
    
<div class="contents">
<div id="introduction-of-data-sources-and-availability" class="section level2">
<h2 class="hasAnchor">
<a href="#introduction-of-data-sources-and-availability" class="anchor"></a>Introduction of data sources and availability</h2>
<p>The data used in this package were original compiled and processed by United States Geographic Services (USGS). The fertilizer data include the application in both farms and non-farms for 1945 through 2012. The folks in USGS utilized the sales data of commercial fertilizer each state or county from the Association of American Plant Food Control Officials (AAPFCO) commercial fertilizer sales data. State estimates were then allocated to the county-level using fertilizer expenditure from the Census of Agriculture as county weights for farm fertilizer, and effective population density as county weights for nonfarm fertilizer. The data sources and other further information are availalbe in Table 1.</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="20%">
<col width="14%">
<col width="12%">
<col width="28%">
</colgroup>
<thead><tr class="header">
<th>Dataset name</th>
<th align="center">Temporal coverage</th>
<th align="center">Source</th>
<th>Website</th>
<th align="left">Comments</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Fertilizer data before 1985</td>
<td align="center">1945 - 1985</td>
<td align="center">USGS</td>
<td><a href="https://pubs.er.usgs.gov/publication/ofr90130">Link</a></td>
<td align="left">Only has farm data.</td>
</tr>
<tr class="even">
<td>Fertilizer data after 1986</td>
<td align="center">1986 - 2012</td>
<td align="center">USGS</td>
<td><a href="https://www.sciencebase.gov/catalog/item/5851b2d1e4b0f99207c4f238">Link</a></td>
<td align="left">Published in 2017.</td>
</tr>
<tr class="odd">
<td>County background data</td>
<td align="center">2010</td>
<td align="center">US Census</td>
<td><a href="https://www.census.gov/geo/maps-data/data/gazetteer2010.html">Link</a></td>
<td align="left">Assume descriptors of counties do not change.</td>
</tr>
<tr class="even">
<td>Manure data before 1997</td>
<td align="center">1982 - 1997</td>
<td align="center">USGS</td>
<td><a href="https://pubs.usgs.gov/sir/2006/5012/">link</a></td>
<td align="left">Manual data into farm every five years</td>
</tr>
<tr class="odd">
<td>Manure data in 2002</td>
<td align="center">2002</td>
<td align="center">USGS</td>
<td><a href="https://pubs.usgs.gov/of/2013/1065/">link</a></td>
<td align="left">Published in 2013</td>
</tr>
<tr class="even">
<td>Manure data in 2007 and 2012</td>
<td align="center">2007 &amp; 2012</td>
<td align="center">USGS</td>
<td><a href="https://www.sciencebase.gov/catalog/item/581ced4ee4b08da350d52303">link</a></td>
<td align="left">Published in 2017</td>
</tr>
</tbody>
</table>
</div>
<div id="data-cleanning-and-processing" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cleanning-and-processing" class="anchor"></a>Data cleanning and processing</h2>
<p>As the county-level fertilizer data were processed at different times and by different researchers, the format of the data are a little bit messy. For the sake of time and efforts to employ a complicated dataset, the author cleaned the data into a <strong>Tidy Data</strong> following these rules from <a href="http://r4ds.had.co.nz/tidy-data.html">Hadley Wickham</a>:</p>
<ul>
<li><ol style="list-style-type: decimal">
<li>Each variable must have its own column.</li>
</ol></li>
<li><ol start="2" style="list-style-type: decimal">
<li>Each observation must have its own row.</li>
</ol></li>
<li><ol start="3" style="list-style-type: decimal">
<li>Each value must have its own cell.</li>
</ol></li>
</ul>
<p>Fig. 1 shows the rules visually.</p>
<p><img src="http://r4ds.had.co.nz/images/tidy-1.png"> Fig. 1 Following three rules makes a dataset tidy: variables are in columns, observations are in rows, and values are in cells.</p>
<p>(The description of tidy data was adapted from <a href="http://r4ds.had.co.nz/"><em>R for data science</em></a>)</p>
<div id="import-libraries-and-data-" class="section level3">
<h3 class="hasAnchor">
<a href="#import-libraries-and-data-" class="anchor"></a>import libraries and data.</h3>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">require</span>(tidyverse)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co"># county level data of fertilizer application.  </span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co">#Source: https://www.sciencebase.gov/catalog/item/5851b2d1e4b0f99207c4f238</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4">raw_data =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"../data-raw/CNTY_FERT_1987-2012.csv"</span>)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="co">#summary(raw_data)</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="co"># County summary from US census bureau.</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co"># Source: https://www.census.gov/geo/maps-data/data/gazetteer2010.html</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9">county_raw =<span class="st"> </span><span class="kw">read.table</span>(<span class="st">"../data-raw/Gaz_counties_national.txt"</span>, <span class="dt">sep =</span> <span class="st">"</span><span class="ch">\t</span><span class="st">"</span>, <span class="dt">header=</span><span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb1-10" data-line-number="10"></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="co"># read in data, extracted from coverage in ArcGIS.</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12">n45_<span class="dv">64</span> &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">"../data-raw/cty_fert0.n45-64.txt"</span>, <span class="dt">sep =</span> <span class="st">","</span>, <span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb1-13" data-line-number="13">n65_<span class="dv">85</span> &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">"../data-raw/cty_fert0.n65-85.txt"</span>, <span class="dt">sep =</span> <span class="st">","</span>, <span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb1-14" data-line-number="14">p45_<span class="dv">64</span> &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">"../data-raw/cty_fert0.p45-64.txt"</span>, <span class="dt">sep =</span> <span class="st">","</span>, <span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb1-15" data-line-number="15">p65_<span class="dv">85</span> &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">"../data-raw/cty_fert0.p65-85.txt"</span>, <span class="dt">sep =</span> <span class="st">","</span>, <span class="dt">header =</span> T)</a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co"># merge nitrogen and P data together.</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17">n45_<span class="dv">85</span> =<span class="st"> </span><span class="kw">inner_join</span>(n45_<span class="dv">64</span>, n65_<span class="dv">85</span>, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"FIPS"</span>,<span class="st">"STATE"</span>,<span class="st">"Rowid_"</span>))</a>
<a class="sourceLine" id="cb1-18" data-line-number="18">p45_<span class="dv">85</span> =<span class="st"> </span><span class="kw">inner_join</span>(p45_<span class="dv">64</span>, p65_<span class="dv">85</span>, <span class="dt">by =</span> <span class="kw">c</span>(<span class="st">"FIPS"</span>,<span class="st">"STATE"</span>,<span class="st">"Rowid_"</span>))</a></code></pre></div>
</div>
</div>
<div id="data-cleanning" class="section level2">
<h2 class="hasAnchor">
<a href="#data-cleanning" class="anchor"></a>Data cleanning</h2>
<div id="clean-data-before-1982-" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-data-before-1982-" class="anchor"></a>clean data before 1982.</h3>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># clean nitroge and phosphorus data.</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">nitrogen_<span class="dv">1985</span> =<span class="st"> </span>n45_<span class="dv">85</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Rowid_) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># remove irrelavent info.</span></a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="st">  </span><span class="co"># add leading zeros for FIPS to make it 5 digits.</span></a>
<a class="sourceLine" id="cb2-5" data-line-number="5"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">FIPS =</span> <span class="kw">str_pad</span>(FIPS, <span class="dv">5</span>, <span class="dt">pad =</span> <span class="st">"0"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-6" data-line-number="6"><span class="st">  </span><span class="kw">gather</span>(Year_temp, Quantity, Y45<span class="op">:</span>Y85) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Fertilizer =</span> <span class="kw">rep</span>(<span class="st">"N"</span>, <span class="kw">length</span>(.<span class="op">$</span>Quantity)),</a>
<a class="sourceLine" id="cb2-8" data-line-number="8">         <span class="dt">Farm.Type =</span> <span class="kw">rep</span>(<span class="st">"farm"</span>, <span class="kw">length</span>(.<span class="op">$</span>Quantity)),</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">         <span class="dt">Year =</span> <span class="kw">paste</span>(<span class="st">"19"</span>,<span class="kw">str_sub</span>(Year_temp, <span class="dt">start =</span> <span class="dv">2</span>),<span class="dt">sep =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb2-10" data-line-number="10">         ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Year_temp)</a>
<a class="sourceLine" id="cb2-12" data-line-number="12"></a>
<a class="sourceLine" id="cb2-13" data-line-number="13">phosphorus_<span class="dv">1985</span> =<span class="st"> </span>p45_<span class="dv">85</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-14" data-line-number="14"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Rowid_) <span class="op">%&gt;%</span><span class="st">  </span><span class="co"># remove irrelavent info.</span></a>
<a class="sourceLine" id="cb2-15" data-line-number="15"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">FIPS =</span> <span class="kw">str_pad</span>(FIPS, <span class="dv">5</span>, <span class="dt">pad =</span> <span class="st">"0"</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="st">  </span><span class="kw">gather</span>(Year_temp, Quantity, Y45<span class="op">:</span>Y85) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Fertilizer =</span> <span class="kw">rep</span>(<span class="st">"P"</span>, <span class="kw">length</span>(.<span class="op">$</span>Quantity)),</a>
<a class="sourceLine" id="cb2-18" data-line-number="18">         <span class="dt">Farm.Type =</span> <span class="kw">rep</span>(<span class="st">"farm"</span>, <span class="kw">length</span>(.<span class="op">$</span>Quantity)),</a>
<a class="sourceLine" id="cb2-19" data-line-number="19">         <span class="dt">Year =</span> <span class="kw">paste</span>(<span class="st">"19"</span>,<span class="kw">str_sub</span>(Year_temp, <span class="dt">start =</span> <span class="dv">2</span>),<span class="dt">sep =</span> <span class="st">""</span>)</a>
<a class="sourceLine" id="cb2-20" data-line-number="20">         ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb2-21" data-line-number="21"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Year_temp)</a>
<a class="sourceLine" id="cb2-22" data-line-number="22"><span class="co"># clean dataset for data before 1985</span></a>
<a class="sourceLine" id="cb2-23" data-line-number="23">clean_data_<span class="dv">1985</span> =<span class="st"> </span><span class="kw">rbind</span>(phosphorus_<span class="dv">1985</span>, nitrogen_<span class="dv">1985</span>)</a></code></pre></div>
</div>
<div id="clean-data-after-1987" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-data-after-1987" class="anchor"></a>clean data after 1987</h3>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># remove duplicates in county data.</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2">county_data =<span class="st"> </span>county_raw <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="st">  </span><span class="kw">distinct</span>(GEOID, <span class="dt">.keep_all =</span> <span class="ot">TRUE</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4"><span class="st">  </span><span class="co"># select certin columns.</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(GEOID, ALAND, AWATER,INTPTLAT, INTPTLONG) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">FIPSno =</span> GEOID) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>GEOID)</a>
<a class="sourceLine" id="cb3-8" data-line-number="8"></a>
<a class="sourceLine" id="cb3-9" data-line-number="9"><span class="co"># combine county data with county level fertilizer data.</span></a>
<a class="sourceLine" id="cb3-10" data-line-number="10">county_summary =<span class="st"> </span><span class="kw">left_join</span>(raw_data,county_data, <span class="dt">by =</span> <span class="st">"FIPSno"</span>)</a>
<a class="sourceLine" id="cb3-11" data-line-number="11"></a>
<a class="sourceLine" id="cb3-12" data-line-number="12">clean_data =<span class="st"> </span>county_summary <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-13" data-line-number="13"><span class="st">  </span><span class="co"># remove some columns with FIPS numbers.</span></a>
<a class="sourceLine" id="cb3-14" data-line-number="14"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(FIPS_st, FIPS_co,FIPSno)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-15" data-line-number="15"><span class="st">  </span><span class="co"># wide to long dataset.</span></a>
<a class="sourceLine" id="cb3-16" data-line-number="16"><span class="st">  </span><span class="kw">gather</span>(Fert.Type, Quantity, farmN1987<span class="op">:</span>nonfP2012) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-17" data-line-number="17"><span class="st">  </span><span class="co"># separate the fert.type into three columns: farm type, fertilizer, year.</span></a>
<a class="sourceLine" id="cb3-18" data-line-number="18"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Year =</span> <span class="kw">str_sub</span>(Fert.Type, <span class="dt">start =</span> <span class="dv">-4</span>), </a>
<a class="sourceLine" id="cb3-19" data-line-number="19">         <span class="dt">Fertilizer =</span> <span class="kw">str_sub</span>(Fert.Type, <span class="dt">start =</span> <span class="dv">-5</span>, <span class="dt">end =</span> <span class="dv">-5</span>),</a>
<a class="sourceLine" id="cb3-20" data-line-number="20">         <span class="dt">Farm.Type =</span> <span class="kw">str_sub</span>(Fert.Type, <span class="dt">start =</span> <span class="dv">1</span>, <span class="dt">end =</span> <span class="dv">4</span>)</a>
<a class="sourceLine" id="cb3-21" data-line-number="21">         ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-22" data-line-number="22"><span class="st">  </span><span class="co"># repalce nonf into nonfarm</span></a>
<a class="sourceLine" id="cb3-23" data-line-number="23"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Farm.Type =</span> <span class="kw">ifelse</span>(Farm.Type <span class="op">==</span><span class="st"> "nonf"</span>, <span class="st">"nonfarm"</span>, <span class="st">"farm"</span>)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb3-24" data-line-number="24"><span class="st">  </span><span class="co"># remove Fert.Type</span></a>
<a class="sourceLine" id="cb3-25" data-line-number="25"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Fert.Type)</a>
<a class="sourceLine" id="cb3-26" data-line-number="26"></a>
<a class="sourceLine" id="cb3-27" data-line-number="27"><span class="co"># extract county summaries info from clean data.</span></a>
<a class="sourceLine" id="cb3-28" data-line-number="28">cnty_summary_<span class="dv">1985</span> =<span class="st"> </span>county_summary <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-29" data-line-number="29"><span class="st">  </span><span class="kw">select</span>(FIPS,State, County, ALAND, AWATER, INTPTLAT, INTPTLONG) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-30" data-line-number="30"><span class="st">  </span><span class="kw">right_join</span>(clean_data_<span class="dv">1985</span>, <span class="dt">by =</span> <span class="st">"FIPS"</span>) </a>
<a class="sourceLine" id="cb3-31" data-line-number="31"></a>
<a class="sourceLine" id="cb3-32" data-line-number="32"><span class="co"># add data from 1945. </span></a>
<a class="sourceLine" id="cb3-33" data-line-number="33">clean_data =<span class="st"> </span><span class="kw">rbind</span>(clean_data, cnty_summary_<span class="dv">1985</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb3-34" data-line-number="34"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">Nutrient =</span> Fertilizer) <span class="op">%&gt;%</span><span class="st"> </span><span class="co"># renam Fertilizer to nutrient.</span></a>
<a class="sourceLine" id="cb3-35" data-line-number="35"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Input.Type =</span> <span class="kw">rep</span>(<span class="st">"Fertilizer"</span>)) <span class="co"># add a colume as fertilizer, compared with Manure.</span></a></code></pre></div>
</div>
<div id="clean-manure-data-before-1997" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-manure-data-before-1997" class="anchor"></a>Clean manure data before 1997</h3>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># read in manure data from 1982 to 1997.</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2">cnty_manure_<span class="dv">97</span> =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"../data-raw/cnty_manure_82-97.csv"</span>)</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">cnty_manure_summary =<span class="st"> </span>cnty_manure_<span class="dv">97</span> <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(State, County)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5"><span class="st">  </span><span class="kw">gather</span>(dummy, Quantity, N_<span class="dv">1982</span><span class="op">:</span>P_<span class="dv">1997</span>) <span class="op">%&gt;%</span><span class="st">   </span><span class="co"># dummy is a temporay column.</span></a>
<a class="sourceLine" id="cb4-6" data-line-number="6"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Farm.Type =</span> <span class="kw">rep</span>(<span class="st">"farm"</span>, <span class="kw">length</span>(.<span class="op">$</span>FIPS)),</a>
<a class="sourceLine" id="cb4-7" data-line-number="7">         <span class="dt">Input.Type =</span> <span class="kw">rep</span>(<span class="st">"Manure"</span>, <span class="kw">length</span>(.<span class="op">$</span>FIPS))) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb4-8" data-line-number="8"><span class="st">  </span><span class="kw">separate</span>(dummy, <span class="kw">c</span>(<span class="st">"Nutrient"</span>, <span class="st">"Year"</span>), <span class="dt">sep =</span> <span class="st">"_"</span>)</a></code></pre></div>
</div>
<div id="clean-manure-data-after-1997" class="section level3">
<h3 class="hasAnchor">
<a href="#clean-manure-data-after-1997" class="anchor"></a>Clean manure data after 1997</h3>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># read in manure data.</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2">cnty_manure_<span class="dv">02</span> =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"../data-raw/cnty_manure_2002.csv"</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">cnty_manure_<span class="dv">07</span> =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"../data-raw/cnty_manure_2007.csv"</span>)</a>
<a class="sourceLine" id="cb5-4" data-line-number="4">cnty_manure_<span class="dv">12</span> =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">"../data-raw/cnty_manure_2012.csv"</span>)</a>
<a class="sourceLine" id="cb5-5" data-line-number="5"></a>
<a class="sourceLine" id="cb5-6" data-line-number="6">cnty_manure_<span class="dv">02</span>_<span class="dv">12</span> =<span class="st"> </span><span class="kw">rbind</span>(cnty_manure_<span class="dv">02</span>, cnty_manure_<span class="dv">07</span>, cnty_manure_<span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-7" data-line-number="7"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="kw">c</span>(State, County)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-8" data-line-number="8"><span class="st">  </span><span class="kw">gather</span>(Nutrient, Quantity, N<span class="op">:</span>P) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb5-9" data-line-number="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Farm.Type =</span> <span class="kw">rep</span>(<span class="st">"farm"</span>, <span class="kw">length</span>(.<span class="op">$</span>FIPS)),</a>
<a class="sourceLine" id="cb5-10" data-line-number="10">         <span class="dt">Input.Type =</span> <span class="kw">rep</span>(<span class="st">"Manure"</span>, <span class="kw">length</span>(.<span class="op">$</span>FIPS)))</a></code></pre></div>
</div>
<div id="save-data-as-rdata-with-compaction" class="section level3">
<h3 class="hasAnchor">
<a href="#save-data-as-rdata-with-compaction" class="anchor"></a>Save data as rdata with compaction</h3>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="co"># connect manure data.</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2">cnty_manure_summary =<span class="st"> </span><span class="kw">rbind</span>(cnty_manure_summary,cnty_manure_<span class="dv">02</span>_<span class="dv">12</span>)</a>
<a class="sourceLine" id="cb6-3" data-line-number="3"></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">cnty_manure_all =<span class="st"> </span>county_summary <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(FIPS,State, County, ALAND, AWATER, INTPTLAT, INTPTLONG) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6"><span class="st">  </span><span class="kw">right_join</span>(cnty_manure_summary, <span class="dt">by =</span> <span class="st">"FIPS"</span>) </a>
<a class="sourceLine" id="cb6-7" data-line-number="7"></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">clean_data =<span class="st"> </span><span class="kw">rbind</span>(clean_data, cnty_manure_all)</a>
<a class="sourceLine" id="cb6-9" data-line-number="9"></a>
<a class="sourceLine" id="cb6-10" data-line-number="10"><span class="co"># NOT RUN</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11"><span class="co"># save cleaned data into .rda format.</span></a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="kw">save</span>(clean_data, <span class="dt">file =</span> <span class="st">"../data/usfertilizer_county.rda"</span>)</a></code></pre></div>
</div>
</div>
<div id="future-development-plan" class="section level2">
<h2 class="hasAnchor">
<a href="#future-development-plan" class="anchor"></a>Future development plan</h2>
<p>There are some future features in the dataset, including:</p>
<ul>
<li>Add missing data in the year of 1986.</li>
<li>Develop a package to retrieve, analyze and visualize the fertilizer data in watersheds.</li>
</ul>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introduction-of-data-sources-and-availability">Introduction of data sources and availability</a></li>
      <li><a href="#data-cleanning-and-processing">Data cleanning and processing</a></li>
      <li><a href="#data-cleanning">Data cleanning</a></li>
      <li><a href="#future-development-plan">Future development plan</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Wenlong Liu.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
